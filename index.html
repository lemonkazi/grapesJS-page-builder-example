<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>GrapesJS Page Builder</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/grapesjs/dist/css/grapes.min.css"
    />
    <script src="https://unpkg.com/grapesjs"></script>
  </head>
  <body>
    <div id="gjs"></div>
    <button onclick="savePage()">Save Page</button>
		<!-- Include the plugins here -->
		<script src="https://unpkg.com/grapesjs-image-editor"></script>
		<script src="https://unpkg.com/grapesjs-forms"></script>
		<script src="https://unpkg.com/grapesjs-blocks-basic"></script>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
		
    <script>
      var editor = grapesjs.init({
				container: '#gjs',
				plugins: ['gjs-blocks-basic', 'gjs-image-editor', 'gjs-forms'],
				blockManager: {
					blocks: [{
						id: 'my-block',
						label: 'My Block',
						content: '<div class="my-block">This is my custom block!</div>',
					}]
				}
			});
			window.onload = function() {
				fetchPageData(1); // Replace 1 with the ID of the page you want to fetch
			}
			function fetchPageData(pageId) {
  $.ajax({
    url: '/fetch-page',
    type: 'POST',
    data: { id: pageId },
    success: function(response) {
      // Set the editor's HTML and CSS content
      editor.setComponents(response.html);
      editor.setStyle(response.css);
    },
    error: function(error) {
      // Show an error message
      alert('Error fetching page: ' + error.message);
    }
  });
}

      function savePage() {
        //editor.getPage().toJSON();
       
        var html = editor.getHtml();
        var css = editor.getCss();
        
        var components = [];
  var componentsEl = editor.DomComponents.getComponents();
  componentsEl.forEach(function(componentEl) {
    var componentHtml = componentEl.toHTML();
    var componentCss = componentEl.getStyle();
    components.push({
      html: componentHtml,
      css: componentCss
    });
  });
   console.log(components);
   console.log(html);
        return false;
        // Save the HTML and CSS to the database
        $.ajax({
          url: "/save-page.php",
          type: "POST",
          data: { html: html, css: css },
          success: function(response) {
						console.log(response);
            alert("Page saved successfully!");
          },
          error: function(error) {
            alert("Error saving page: " + error.message);
          },
        });
      }
    </script>
  </body>
</html>
